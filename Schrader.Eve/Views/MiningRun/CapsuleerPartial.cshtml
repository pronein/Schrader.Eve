@model IEnumerable<Schrader.Eve.Models.MiningRunCapsuleer>

<div style="width: 700px;">
    <div id="capsuleer_detail">
        @Html.Partial("CapsuleerDetailPartial", Model.First())
    </div>
    <div style="display: block; position: relative; margin-left: 44px;">
        <div class="capsuleer-carousel">
            <ul>
                @foreach (var capsuleer in Model)
                {
                    <li>
                        <img data-cid="@capsuleer.Pilot.CharacterId"
                             src="@string.Format("http://image.eveonline.com/Character/{0}_128.jpg", capsuleer.Pilot.CharacterId)"
                             width="128" height="128" />
                    </li>
                }
            </ul>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        var capsuleerCount = parseInt(@Model.Count());

        var $carousel = $('.capsuleer-carousel');
        $carousel.jCarouselLite({
            btnNext: ".next",
            btnPrev: ".prev",
            auto: capsuleerCount > 4 ? 5000 : 0,
            speed: 800,
            visible: 4,
            afterEnd: afterEndCallback
        });

        function afterEndCallback(items) {
            var $currentItem = $(items[0]).children(0);
            var cid = $currentItem.data('cid');

            $.ajax({
                url: '@Url.Action("ShowCapsuleerDetailPartial", "MiningRun")',
                data: { characterId: cid },
                cache: false,
                type: "POST",
                dataType: "html",
                success: function (data, textStatus, XMLHttpRequest) {
                    $capsuleerDetailDiv = $('#capsuleer_detail');
                    $capsuleerDetailDiv.html(data);
                }
            });
        };
    });
</script>
